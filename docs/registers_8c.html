<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iSensor-SPI-Buffer: C:/Users/anolan3/Documents/iSensor-SPI-Buffer/Core/Src/registers.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Analog-Devices-Logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iSensor-SPI-Buffer
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Firmware for the STM32F303 to enable full throughput buffered data capture on Analog Devices IMUs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a class="el" href="dir_b596f468b52957496e4f78b80e029268.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">registers.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>iSensor-SPI-Buffer register interfacing  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="registers_8h_source.html">registers.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aeee7c6312a09dcb27a9d0b68fe37afcf"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#aeee7c6312a09dcb27a9d0b68fe37afcf">ReadReg</a> (uint8_t regAddr)</td></tr>
<tr class="memdesc:aeee7c6312a09dcb27a9d0b68fe37afcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process a register read request (from master)  <a href="#aeee7c6312a09dcb27a9d0b68fe37afcf">More...</a><br /></td></tr>
<tr class="separator:aeee7c6312a09dcb27a9d0b68fe37afcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14e4e9f1315bb4941574076d9a824d4a"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#a14e4e9f1315bb4941574076d9a824d4a">WriteReg</a> (uint8_t regAddr, uint8_t regValue)</td></tr>
<tr class="memdesc:a14e4e9f1315bb4941574076d9a824d4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process a register write request (from master)  <a href="#a14e4e9f1315bb4941574076d9a824d4a">More...</a><br /></td></tr>
<tr class="separator:a14e4e9f1315bb4941574076d9a824d4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ca885362e30b509afa7d4138c686ba3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#a9ca885362e30b509afa7d4138c686ba3">ProcessCommand</a> ()</td></tr>
<tr class="memdesc:a9ca885362e30b509afa7d4138c686ba3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes a command register write. This function is called from main loop.  <a href="#a9ca885362e30b509afa7d4138c686ba3">More...</a><br /></td></tr>
<tr class="separator:a9ca885362e30b509afa7d4138c686ba3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e4cc4aaf47e349fdaedc1df90274cab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#a1e4cc4aaf47e349fdaedc1df90274cab">FactoryReset</a> ()</td></tr>
<tr class="memdesc:a1e4cc4aaf47e349fdaedc1df90274cab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load factory default values for all registers, and applies any settings changes.  <a href="#a1e4cc4aaf47e349fdaedc1df90274cab">More...</a><br /></td></tr>
<tr class="separator:a1e4cc4aaf47e349fdaedc1df90274cab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b32151b1c6c1f3adcf8c1b2d245d191"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#a7b32151b1c6c1f3adcf8c1b2d245d191">GetSN</a> ()</td></tr>
<tr class="memdesc:a7b32151b1c6c1f3adcf8c1b2d245d191"><td class="mdescLeft">&#160;</td><td class="mdescRight">Populates the six SN registers automatically.  <a href="#a7b32151b1c6c1f3adcf8c1b2d245d191">More...</a><br /></td></tr>
<tr class="separator:a7b32151b1c6c1f3adcf8c1b2d245d191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a042bb33891e7dcafa8dcf3a696eaa451"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#a042bb33891e7dcafa8dcf3a696eaa451">GetBuildDate</a> ()</td></tr>
<tr class="memdesc:a042bb33891e7dcafa8dcf3a696eaa451"><td class="mdescLeft">&#160;</td><td class="mdescRight">Populates the firmware date registers automatically.  <a href="#a042bb33891e7dcafa8dcf3a696eaa451">More...</a><br /></td></tr>
<tr class="separator:a042bb33891e7dcafa8dcf3a696eaa451"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af97575ad183f8358642b8158353e5727"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#af97575ad183f8358642b8158353e5727">UpdateUserSpiConfig</a> ()</td></tr>
<tr class="memdesc:af97575ad183f8358642b8158353e5727"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the slave SPI (SPI2) config based on the USER_SPI_CONFIG register.  <a href="#af97575ad183f8358642b8158353e5727">More...</a><br /></td></tr>
<tr class="separator:af97575ad183f8358642b8158353e5727"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab9da65f935e805137e2eb4e18c5ab224"><td class="memItemLeft" align="right" valign="top">SPI_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#ab9da65f935e805137e2eb4e18c5ab224">hspi2</a></td></tr>
<tr class="separator:ab9da65f935e805137e2eb4e18c5ab224"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a954f038896c833cf36970b00a32329ac"><td class="memItemLeft" align="right" valign="top">volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#a954f038896c833cf36970b00a32329ac">selected_page</a> = <a class="el" href="registers_8h.html#af9e2cac6aba29082e8e722c945b8c935">BUF_CONFIG_PAGE</a></td></tr>
<tr class="separator:a954f038896c833cf36970b00a32329ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8eeee913da74a5a5d82a640cb57bab8e"><td class="memItemLeft" align="right" valign="top">volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#a8eeee913da74a5a5d82a640cb57bab8e">update_flags</a> = 0</td></tr>
<tr class="separator:a8eeee913da74a5a5d82a640cb57bab8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4b0c41a860f8f069e019ab05c0d1ab4"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="registers_8c.html#ab4b0c41a860f8f069e019ab05c0d1ab4">regs</a> [3 *REG_PER_PAGE]</td></tr>
<tr class="separator:ab4b0c41a860f8f069e019ab05c0d1ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>iSensor-SPI-Buffer register interfacing </p>
<p>Copyright (c) Analog Devices Inc, 2020 All Rights Reserved.</p>
<dl class="section date"><dt>Date</dt><dd>3/18/2020 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>A. Nolan (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'x.'+'nol'+'an'+'@an'+'al'+'og.'+'co'+'m'; return false;">alex.<span style="display: none;">.nosp@m.</span>nola<span style="display: none;">.nosp@m.</span>n@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a1e4cc4aaf47e349fdaedc1df90274cab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e4cc4aaf47e349fdaedc1df90274cab">&#9670;&nbsp;</a></span>FactoryReset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void FactoryReset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load factory default values for all registers, and applies any settings changes. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This is accomplished in "lazy" manner via #define for each register default value (defaults are stored in program memory, storage is managed by compiler). This function only changes values in SRAM, does not change flash contents (registers will reset on next re-boot). </p>

</div>
</div>
<a id="a042bb33891e7dcafa8dcf3a696eaa451"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a042bb33891e7dcafa8dcf3a696eaa451">&#9670;&nbsp;</a></span>GetBuildDate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetBuildDate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Populates the firmware date registers automatically. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Registers are populated by parsing the <b>DATE</b> macro result, which is set at compile time </p>

</div>
</div>
<a id="a7b32151b1c6c1f3adcf8c1b2d245d191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b32151b1c6c1f3adcf8c1b2d245d191">&#9670;&nbsp;</a></span>GetSN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetSN </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Populates the six SN registers automatically. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>The SN registers are populated from the 96-bit unique ID (UID) </p>

</div>
</div>
<a id="a9ca885362e30b509afa7d4138c686ba3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ca885362e30b509afa7d4138c686ba3">&#9670;&nbsp;</a></span>ProcessCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ProcessCommand </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes a command register write. This function is called from main loop. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Only one command can be executed per write to the USER_COMMAND register. Command execution priority is determined by the order in which the command flags are checked. </p>

</div>
</div>
<a id="aeee7c6312a09dcb27a9d0b68fe37afcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeee7c6312a09dcb27a9d0b68fe37afcf">&#9670;&nbsp;</a></span>ReadReg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t ReadReg </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>regAddr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process a register read request (from master) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">regAddr</td><td>The byte address of the register to read</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Value of register requested</dd></dl>
<p>For selected pages not addressed by iSensor-SPI-Buffer, the read is passed through to the connected IMU, using the spi_passthrough module. If the selected page is [253 - 255] this read request is processed directly. </p>

</div>
</div>
<a id="af97575ad183f8358642b8158353e5727"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af97575ad183f8358642b8158353e5727">&#9670;&nbsp;</a></span>UpdateUserSpiConfig()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateUserSpiConfig </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates the slave SPI (SPI2) config based on the USER_SPI_CONFIG register. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function performs all needed initialization for the slave SPI port, and should be called as start of the firmware start up process. </p>

</div>
</div>
<a id="a14e4e9f1315bb4941574076d9a824d4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14e4e9f1315bb4941574076d9a824d4a">&#9670;&nbsp;</a></span>WriteReg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t WriteReg </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>regAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>regValue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process a register write request (from master) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">regAddr</td><td>The address of the register to write to</td></tr>
    <tr><td class="paramname">regValue</td><td>The value to write to the register</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The contents of the register being written, after write is processed</dd></dl>
<p>For selected pages not addressed by iSensor-SPI-Buffer, the write is passed through to the connected IMU, using the spi_passthrough module. If the selected page is [253 - 255] this write request is processed directly. The firmware echoes back the processed write value so that the master can verify the write contents on the next SPI transaction. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab9da65f935e805137e2eb4e18c5ab224"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9da65f935e805137e2eb4e18c5ab224">&#9670;&nbsp;</a></span>hspi2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SPI_HandleTypeDef hspi2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>SPI handle for slave port (from master controller) </p>

</div>
</div>
<a id="ab4b0c41a860f8f069e019ab05c0d1ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4b0c41a860f8f069e019ab05c0d1ab4">&#9670;&nbsp;</a></span>regs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t regs[3 *REG_PER_PAGE]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>iSensor-SPI-Buffer global register array (read-able via SPI) </p>

</div>
</div>
<a id="a954f038896c833cf36970b00a32329ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a954f038896c833cf36970b00a32329ac">&#9670;&nbsp;</a></span>selected_page</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint32_t selected_page = <a class="el" href="registers_8h.html#af9e2cac6aba29082e8e722c945b8c935">BUF_CONFIG_PAGE</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Selected page. Starts on 253 (config page) </p>

</div>
</div>
<a id="a8eeee913da74a5a5d82a640cb57bab8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8eeee913da74a5a5d82a640cb57bab8e">&#9670;&nbsp;</a></span>update_flags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint32_t update_flags = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register update flags for main loop processing </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
