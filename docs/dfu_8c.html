<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iSensor-SPI-Buffer: dfu.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Analog-Devices-Logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iSensor-SPI-Buffer
   &#160;<span id="projectnumber">1.15</span>
   </div>
   <div id="projectbrief">Firmware for the iSensor-SPI-Buffer board to enable full throughput buffered data capture on Analog Devices IMUs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d9edf6c004b4a7ff14fe9ae7a92214ee.html">firmware</a></li><li class="navelem"><a class="el" href="dir_344ad9cf7012f4665e17c8bfb6616899.html">Core</a></li><li class="navelem"><a class="el" href="dir_6fab3234299e4772a3d79f4ae41b7a51.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dfu.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation file for iSensor-SPI-Buffer runtime firmware upgrade module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="usb_8h_source.html">usb.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="dfu_8h_source.html">dfu.h</a>&quot;</code><br />
<code>#include &quot;stm32f303xe.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dfu.c:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c__incl.png" border="0" usemap="#adfu_8c" alt=""/></div>
<map name="dfu_8c" id="adfu_8c">
<area shape="rect" title="Implementation file for iSensor&#45;SPI&#45;Buffer runtime firmware upgrade module." alt="" coords="90,5,141,32"/>
<area shape="rect" href="usb_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer USB command line register interface." alt="" coords="88,80,143,107"/>
<area shape="rect" href="dfu_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer runtime firmware upgrade module." alt="" coords="13,80,63,107"/>
<area shape="rect" title=" " alt="" coords="167,80,274,107"/>
<area shape="rect" title=" " alt="" coords="5,155,71,181"/>
<area shape="rect" href="main_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer main." alt="" coords="95,155,157,181"/>
<area shape="rect" title=" " alt="" coords="67,229,185,256"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad6c7d5abd728d3d19ad622cfe4367ff6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu_8c.html#ad6c7d5abd728d3d19ad622cfe4367ff6">ExecuteDFUBoot</a> ()</td></tr>
<tr class="memdesc:ad6c7d5abd728d3d19ad622cfe4367ff6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a DFU reboot.  <a href="dfu_8c.html#ad6c7d5abd728d3d19ad622cfe4367ff6">More...</a><br /></td></tr>
<tr class="separator:ad6c7d5abd728d3d19ad622cfe4367ff6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4049fa9d2bc5a43fcd551bf41bfd98f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu_8c.html#ac4049fa9d2bc5a43fcd551bf41bfd98f">DFU_Check_Flags</a> ()</td></tr>
<tr class="memdesc:ac4049fa9d2bc5a43fcd551bf41bfd98f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if a reboot into the DFU bootloader is needed.  <a href="dfu_8c.html#ac4049fa9d2bc5a43fcd551bf41bfd98f">More...</a><br /></td></tr>
<tr class="separator:ac4049fa9d2bc5a43fcd551bf41bfd98f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b9e7205fb97cb7aeccc6762dbe52045"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu_8c.html#a4b9e7205fb97cb7aeccc6762dbe52045">DFU_Prepare_Reboot</a> ()</td></tr>
<tr class="memdesc:a4b9e7205fb97cb7aeccc6762dbe52045"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set DFU reboot flag in RAM and reset system.  <a href="dfu_8c.html#a4b9e7205fb97cb7aeccc6762dbe52045">More...</a><br /></td></tr>
<tr class="separator:a4b9e7205fb97cb7aeccc6762dbe52045"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5132366b9e706dafb950ba3e46b0eadd"><td class="memItemLeft" align="right" valign="top"><a id="a5132366b9e706dafb950ba3e46b0eadd"></a>
void(*&#160;</td><td class="memItemRight" valign="bottom"><b>SysMemBootJump</b> )(void)</td></tr>
<tr class="separator:a5132366b9e706dafb950ba3e46b0eadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation file for iSensor-SPI-Buffer runtime firmware upgrade module. </p>
<p>Copyright (c) Analog Devices Inc, 2020 All Rights Reserved.</p>
<dl class="section date"><dt>Date</dt><dd>10/9/2020 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>A. Nolan (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'x.'+'nol'+'an'+'@an'+'al'+'og.'+'co'+'m'; return false;">alex.<span style="display: none;">.nosp@m.</span>nola<span style="display: none;">.nosp@m.</span>n@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac4049fa9d2bc5a43fcd551bf41bfd98f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4049fa9d2bc5a43fcd551bf41bfd98f">&#9670;&nbsp;</a></span>DFU_Check_Flags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DFU_Check_Flags </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if a reboot into the DFU bootloader is needed. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function should be the first called in the main routine. The less which is configured before entering DFU mode, the easier. This function checks for a DFU reboot flag set in a "no-initialize" section of SRAM to determine if booting into DFU mode is needed. This flag must be set by the application code on the prior run, when a bootloader reboot command is received. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_cgraph.png" border="0" usemap="#adfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_cgraph" alt=""/></div>
<map name="dfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_cgraph" id="dfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_cgraph">
<area shape="rect" title="Checks if a reboot into the DFU bootloader is needed." alt="" coords="5,5,136,32"/>
<area shape="rect" href="dfu_8c.html#ad6c7d5abd728d3d19ad622cfe4367ff6" title="Executes a DFU reboot." alt="" coords="184,5,307,32"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_icgraph.png" border="0" usemap="#adfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_icgraph" alt=""/></div>
<map name="dfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_icgraph" id="dfu_8c_ac4049fa9d2bc5a43fcd551bf41bfd98f_icgraph">
<area shape="rect" title="Checks if a reboot into the DFU bootloader is needed." alt="" coords="104,5,235,32"/>
<area shape="rect" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="The application entry point." alt="" coords="5,5,56,32"/>
</map>
</div>

</div>
</div>
<a id="a4b9e7205fb97cb7aeccc6762dbe52045"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b9e7205fb97cb7aeccc6762dbe52045">&#9670;&nbsp;</a></span>DFU_Prepare_Reboot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DFU_Prepare_Reboot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set DFU reboot flag in RAM and reset system. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Resetting the system ensures the processor core is in a good state to load the bootloader on the next initialization. To run the bootloader, it is important that no interrupts are enabled, stack is cleared, processor is running from internal clock, and no hardware peripherals are active. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c_a4b9e7205fb97cb7aeccc6762dbe52045_cgraph.png" border="0" usemap="#adfu_8c_a4b9e7205fb97cb7aeccc6762dbe52045_cgraph" alt=""/></div>
<map name="dfu_8c_a4b9e7205fb97cb7aeccc6762dbe52045_cgraph" id="dfu_8c_a4b9e7205fb97cb7aeccc6762dbe52045_cgraph">
<area shape="rect" title="Set DFU reboot flag in RAM and reset system." alt="" coords="5,5,153,32"/>
<area shape="rect" href="usb_8c.html#af1aec7b3c1d6bc30ddc783c304ff04cc" title="Toggle USB PU to force a re&#45;enumeration on the host side." alt="" coords="201,5,292,32"/>
<area shape="rect" href="timer_8c.html#a610c9ca08bddd3bae993770ce68a19c8" title="Blocking sleep function call." alt="" coords="340,5,523,32"/>
</map>
</div>

</div>
</div>
<a id="ad6c7d5abd728d3d19ad622cfe4367ff6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6c7d5abd728d3d19ad622cfe4367ff6">&#9670;&nbsp;</a></span>ExecuteDFUBoot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ExecuteDFUBoot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Executes a DFU reboot. </p>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c_ad6c7d5abd728d3d19ad622cfe4367ff6_icgraph.png" border="0" usemap="#adfu_8c_ad6c7d5abd728d3d19ad622cfe4367ff6_icgraph" alt=""/></div>
<map name="dfu_8c_ad6c7d5abd728d3d19ad622cfe4367ff6_icgraph" id="dfu_8c_ad6c7d5abd728d3d19ad622cfe4367ff6_icgraph">
<area shape="rect" title="Executes a DFU reboot." alt="" coords="283,5,405,32"/>
<area shape="rect" href="dfu_8c.html#ac4049fa9d2bc5a43fcd551bf41bfd98f" title="Checks if a reboot into the DFU bootloader is needed." alt="" coords="104,5,235,32"/>
<area shape="rect" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="The application entry point." alt="" coords="5,5,56,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
