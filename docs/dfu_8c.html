<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iSensor-SPI-Buffer: dfu.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Analog-Devices-Logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iSensor-SPI-Buffer
   &#160;<span id="projectnumber">1.14</span>
   </div>
   <div id="projectbrief">Firmware for the iSensor-SPI-Buffer board to enable full throughput buffered data capture on Analog Devices IMUs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d9edf6c004b4a7ff14fe9ae7a92214ee.html">firmware</a></li><li class="navelem"><a class="el" href="dir_344ad9cf7012f4665e17c8bfb6616899.html">Core</a></li><li class="navelem"><a class="el" href="dir_6fab3234299e4772a3d79f4ae41b7a51.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dfu.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation file for iSensor-SPI-Buffer runtime firmware upgrade module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="dfu_8h_source.html">dfu.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="usb__cli_8h_source.html">usb_cli.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dfu.c:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c__incl.png" border="0" usemap="#adfu_8c" alt=""/></div>
<map name="dfu_8c" id="dfu_8c">
<area shape="rect" title="Implementation file for iSensor&#45;SPI&#45;Buffer runtime firmware upgrade module." alt="" coords="2372,5,2423,32"/>
<area shape="rect" href="dfu_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer runtime firmware upgrade module." alt="" coords="2092,453,2143,480"/>
<area shape="rect" href="usb__cli_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer USB command line register interface." alt="" coords="2887,80,2961,107"/>
<area shape="rect" title=" " alt="" coords="2073,528,2180,555"/>
<area shape="rect" href="main_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer main." alt="" coords="2457,229,2519,256"/>
<area shape="rect" href="registers_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer register interfacing module." alt="" coords="2447,379,2529,405"/>
<area shape="rect" title=" " alt="" coords="2981,155,3083,181"/>
<area shape="rect" href="script_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer script module (loaded from SD card)" alt="" coords="2891,155,2957,181"/>
<area shape="rect" title=" " alt="" coords="2320,603,2437,629"/>
<area shape="rect" href="timer_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer timer module." alt="" coords="2830,528,2893,555"/>
<area shape="rect" href="buffer_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer buffer data structure module." alt="" coords="2748,453,2812,480"/>
<area shape="rect" href="flash_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer flash memory interfacing functions." alt="" coords="2218,453,2278,480"/>
<area shape="rect" href="led_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer LED control module." alt="" coords="2416,528,2467,555"/>
<area shape="rect" href="user__interrupt_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer user interrupt (data ready) config and generation functions." alt="" coords="2327,304,2439,331"/>
<area shape="rect" href="watchdog_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer watchdog timer module." alt="" coords="2215,304,2303,331"/>
<area shape="rect" href="dio_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer DIO interfacing module." alt="" coords="2140,304,2191,331"/>
<area shape="rect" title=" " alt="" coords="2538,304,2635,331"/>
<area shape="rect" href="adc_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer ADC module (for temp sensor and Vdd monitoring)" alt="" coords="1909,304,1963,331"/>
<area shape="rect" href="imu__spi_8h.html" title="Implementation for iSensor&#45;SPI&#45;Buffer IMU interfacing module." alt="" coords="2645,453,2723,480"/>
<area shape="rect" href="data__capture_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer autonomous IMU data acquisition module." alt="" coords="2354,453,2462,480"/>
<area shape="rect" href="user__spi_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer user SPI (slave SPI) module." alt="" coords="2537,453,2620,480"/>
<area shape="rect" title=" " alt="" coords="2275,528,2341,555"/>
<area shape="rect" title=" " alt="" coords="2141,379,2203,405"/>
<area shape="rect" href="stm32f3xx__hal__conf_8h.html" title="HAL configuration file." alt="" coords="1081,379,1229,405"/>
<area shape="rect" title=" " alt="" coords="43,453,186,480"/>
<area shape="rect" title=" " alt="" coords="210,453,358,480"/>
<area shape="rect" title=" " alt="" coords="382,453,527,480"/>
<area shape="rect" title=" " alt="" coords="552,453,701,480"/>
<area shape="rect" title=" " alt="" coords="725,453,885,480"/>
<area shape="rect" title=" " alt="" coords="910,453,1055,480"/>
<area shape="rect" title=" " alt="" coords="1079,453,1230,480"/>
<area shape="rect" title=" " alt="" coords="1255,453,1396,480"/>
<area shape="rect" title=" " alt="" coords="1421,453,1566,480"/>
<area shape="rect" title=" " alt="" coords="1591,453,1735,480"/>
<area shape="rect" title=" " alt="" coords="1759,453,1900,480"/>
<area shape="rect" title=" " alt="" coords="1925,453,2067,480"/>
<area shape="rect" href="sd__card_8h.html" title="Header file for iSensor&#45;SPI&#45;Buffer SD card interfacing and script execution module." alt="" coords="2962,229,3041,256"/>
<area shape="rect" title=" " alt="" coords="3063,304,3121,331"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad6c7d5abd728d3d19ad622cfe4367ff6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu_8c.html#ad6c7d5abd728d3d19ad622cfe4367ff6">ExecuteDFUBoot</a> ()</td></tr>
<tr class="memdesc:ad6c7d5abd728d3d19ad622cfe4367ff6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a DFU reboot.  <a href="dfu_8c.html#ad6c7d5abd728d3d19ad622cfe4367ff6">More...</a><br /></td></tr>
<tr class="separator:ad6c7d5abd728d3d19ad622cfe4367ff6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5242e31871f00137a8e05029329fcddd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu_8c.html#a5242e31871f00137a8e05029329fcddd">CheckDFUFlags</a> ()</td></tr>
<tr class="memdesc:a5242e31871f00137a8e05029329fcddd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if a reboot into the DFU bootloader is needed.  <a href="dfu_8c.html#a5242e31871f00137a8e05029329fcddd">More...</a><br /></td></tr>
<tr class="separator:a5242e31871f00137a8e05029329fcddd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74325989ab8f68d7299d0c5ff0072f99"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dfu_8c.html#a74325989ab8f68d7299d0c5ff0072f99">PrepareDFUBoot</a> ()</td></tr>
<tr class="memdesc:a74325989ab8f68d7299d0c5ff0072f99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set DFU reboot flag in RAM and reset system.  <a href="dfu_8c.html#a74325989ab8f68d7299d0c5ff0072f99">More...</a><br /></td></tr>
<tr class="separator:a74325989ab8f68d7299d0c5ff0072f99"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5132366b9e706dafb950ba3e46b0eadd"><td class="memItemLeft" align="right" valign="top"><a id="a5132366b9e706dafb950ba3e46b0eadd"></a>
void(*&#160;</td><td class="memItemRight" valign="bottom"><b>SysMemBootJump</b> )(void)</td></tr>
<tr class="separator:a5132366b9e706dafb950ba3e46b0eadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation file for iSensor-SPI-Buffer runtime firmware upgrade module. </p>
<p>Copyright (c) Analog Devices Inc, 2020 All Rights Reserved.</p>
<dl class="section date"><dt>Date</dt><dd>10/9/2020 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>A. Nolan (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'x.'+'nol'+'an'+'@an'+'al'+'og.'+'co'+'m'; return false;">alex.<span style="display: none;">.nosp@m.</span>nola<span style="display: none;">.nosp@m.</span>n@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a5242e31871f00137a8e05029329fcddd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5242e31871f00137a8e05029329fcddd">&#9670;&nbsp;</a></span>CheckDFUFlags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckDFUFlags </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if a reboot into the DFU bootloader is needed. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function should be the first called in the main routine. The less which is configured before entering DFU mode, the easier. This function checks for a DFU reboot flag set in a "no-initialize" section of SRAM to determine if booting into DFU mode is needed. This flag must be set by the application code on the prior run, when a bootloader reboot command is received. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c_a5242e31871f00137a8e05029329fcddd_icgraph.png" border="0" usemap="#adfu_8c_a5242e31871f00137a8e05029329fcddd_icgraph" alt=""/></div>
<map name="dfu_8c_a5242e31871f00137a8e05029329fcddd_icgraph" id="dfu_8c_a5242e31871f00137a8e05029329fcddd_icgraph">
<area shape="rect" title="Checks if a reboot into the DFU bootloader is needed." alt="" coords="104,5,221,32"/>
<area shape="rect" href="main_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="The application entry point." alt="" coords="5,5,56,32"/>
</map>
</div>

</div>
</div>
<a id="ad6c7d5abd728d3d19ad622cfe4367ff6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6c7d5abd728d3d19ad622cfe4367ff6">&#9670;&nbsp;</a></span>ExecuteDFUBoot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ExecuteDFUBoot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Executes a DFU reboot. </p>
<dl class="section return"><dt>Returns</dt><dd>void </dd></dl>

</div>
</div>
<a id="a74325989ab8f68d7299d0c5ff0072f99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74325989ab8f68d7299d0c5ff0072f99">&#9670;&nbsp;</a></span>PrepareDFUBoot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrepareDFUBoot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set DFU reboot flag in RAM and reset system. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Resetting the system ensures the processor core is in a good state to load the bootloader on the next initialization. To run the bootloader, it is important that no interrupts are enabled, stack is cleared, processor is running from internal clock, and no hardware peripherals are active. </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dfu_8c_a74325989ab8f68d7299d0c5ff0072f99_cgraph.png" border="0" usemap="#adfu_8c_a74325989ab8f68d7299d0c5ff0072f99_cgraph" alt=""/></div>
<map name="dfu_8c_a74325989ab8f68d7299d0c5ff0072f99_cgraph" id="dfu_8c_a74325989ab8f68d7299d0c5ff0072f99_cgraph">
<area shape="rect" title="Set DFU reboot flag in RAM and reset system." alt="" coords="5,5,125,32"/>
<area shape="rect" href="usb__cli_8c.html#aee6d4fccc322dac2ddfc6e1321d27234" title="HDisconnect USB device from the host." alt="" coords="173,5,288,32"/>
<area shape="rect" href="timer_8c.html#ad679c296af1e7b89bd58be986d71d985" title="Blocking sleep function call." alt="" coords="336,5,472,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
