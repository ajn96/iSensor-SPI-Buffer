<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iSensor-SPI-Buffer: C:/Users/anolan3/Documents/iSensor-SPI-Buffer/Core/Src/user_spi.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Analog-Devices-Logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iSensor-SPI-Buffer
   &#160;<span id="projectnumber">1.11</span>
   </div>
   <div id="projectbrief">Firmware for the STM32F303 to enable full throughput buffered data capture on Analog Devices IMUs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a class="el" href="dir_b596f468b52957496e4f78b80e029268.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">user_spi.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>iSensor-SPI-Buffer user (slave) SPI module  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="user__spi_8h_source.html">user_spi.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0cf0803624b0e83866ea3dd06b23b05a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#a0cf0803624b0e83866ea3dd06b23b05a">UserSpiReset</a> ()</td></tr>
<tr class="memdesc:a0cf0803624b0e83866ea3dd06b23b05a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset user SPI port.  <a href="user__spi_8c.html#a0cf0803624b0e83866ea3dd06b23b05a">More...</a><br /></td></tr>
<tr class="separator:a0cf0803624b0e83866ea3dd06b23b05a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f1e131bf66f71bfe6d9c3b30f3d9d00"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#a4f1e131bf66f71bfe6d9c3b30f3d9d00">BurstReadSetup</a> ()</td></tr>
<tr class="memdesc:a4f1e131bf66f71bfe6d9c3b30f3d9d00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures SPI for a burst buffer read.  <a href="user__spi_8c.html#a4f1e131bf66f71bfe6d9c3b30f3d9d00">More...</a><br /></td></tr>
<tr class="separator:a4f1e131bf66f71bfe6d9c3b30f3d9d00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ba4975cc957879494953133d89031a5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#a3ba4975cc957879494953133d89031a5">BurstReadDisable</a> ()</td></tr>
<tr class="memdesc:a3ba4975cc957879494953133d89031a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Restore SPI functionality after a burst read.  <a href="user__spi_8c.html#a3ba4975cc957879494953133d89031a5">More...</a><br /></td></tr>
<tr class="separator:a3ba4975cc957879494953133d89031a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad15c7b76347823955edf42ec381e9793"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#ad15c7b76347823955edf42ec381e9793">UpdateUserSpiConfig</a> (uint32_t CheckUnlock)</td></tr>
<tr class="memdesc:ad15c7b76347823955edf42ec381e9793"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the slave SPI (SPI2) config based on the USER_SPI_CONFIG register.  <a href="user__spi_8c.html#ad15c7b76347823955edf42ec381e9793">More...</a><br /></td></tr>
<tr class="separator:ad15c7b76347823955edf42ec381e9793"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a090b8a30a19d0dbdd3dbcfed8dc2df69"><td class="memItemLeft" align="right" valign="top">volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#a090b8a30a19d0dbdd3dbcfed8dc2df69">g_userburstRunning</a></td></tr>
<tr class="separator:a090b8a30a19d0dbdd3dbcfed8dc2df69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35c3e3dee022adebf0fc138c81b515b9"><td class="memItemLeft" align="right" valign="top">SPI_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#a35c3e3dee022adebf0fc138c81b515b9">g_spi2</a></td></tr>
<tr class="separator:a35c3e3dee022adebf0fc138c81b515b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac514950ea85e080587ac1d5fa432f219"><td class="memItemLeft" align="right" valign="top">volatile uint16_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#ac514950ea85e080587ac1d5fa432f219">g_CurrentBufEntry</a></td></tr>
<tr class="separator:ac514950ea85e080587ac1d5fa432f219"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9abdec236745828926dbed3d25cfad5"><td class="memItemLeft" align="right" valign="top">volatile uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="user__spi_8c.html#ad9abdec236745828926dbed3d25cfad5">g_regs</a> [3 *REG_PER_PAGE]</td></tr>
<tr class="separator:ad9abdec236745828926dbed3d25cfad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>iSensor-SPI-Buffer user (slave) SPI module </p>
<p>Copyright (c) Analog Devices Inc, 2020 All Rights Reserved.</p>
<dl class="section date"><dt>Date</dt><dd>4/28/2020 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>A. Nolan (<a href="#" onclick="location.href='mai'+'lto:'+'ale'+'x.'+'nol'+'an'+'@an'+'al'+'og.'+'co'+'m'; return false;">alex.<span style="display: none;">.nosp@m.</span>nola<span style="display: none;">.nosp@m.</span>n@ana<span style="display: none;">.nosp@m.</span>log.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3ba4975cc957879494953133d89031a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ba4975cc957879494953133d89031a5">&#9670;&nbsp;</a></span>BurstReadDisable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BurstReadDisable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Restore SPI functionality after a burst read. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function disables SPI2 DMA requests via hard reset, and disables SPI2 DMA channel </p>

</div>
</div>
<a id="a4f1e131bf66f71bfe6d9c3b30f3d9d00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f1e131bf66f71bfe6d9c3b30f3d9d00">&#9670;&nbsp;</a></span>BurstReadSetup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BurstReadSetup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures SPI for a burst buffer read. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function must be called when there is buffered data available to be read, which has been copied to the buffer output data registers. </p>

</div>
</div>
<a id="ad15c7b76347823955edf42ec381e9793"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad15c7b76347823955edf42ec381e9793">&#9670;&nbsp;</a></span>UpdateUserSpiConfig()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UpdateUserSpiConfig </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>CheckUnlock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates the slave SPI (SPI2) config based on the USER_SPI_CONFIG register. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">CheckUnlock</td><td>Flag to check if the USER_SPI is unlocked (0xA5 written to config reg upper)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>This function performs all needed initialization for the slave SPI port, and should be called as start of the firmware start up process. If CheckUnlock is true, then the function will check that the upper 8 bits of USER_SPI_CONFIG is 0xA5. If it is not, the SPI update will not be processed. This prevents accidental writes to the SPI config register. </p>

</div>
</div>
<a id="a0cf0803624b0e83866ea3dd06b23b05a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cf0803624b0e83866ea3dd06b23b05a">&#9670;&nbsp;</a></span>UserSpiReset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UserSpiReset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset user SPI port. </p>
<dl class="section return"><dt>Returns</dt><dd>void</dd></dl>
<p>Disable and re-enable SPI using RCC. Kind of hacky, not a clean way to do this. This is required because there is no way to clear Tx FIFO in the SPI peripheral otherwise </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ac514950ea85e080587ac1d5fa432f219"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac514950ea85e080587ac1d5fa432f219">&#9670;&nbsp;</a></span>g_CurrentBufEntry</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t* g_CurrentBufEntry</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pointer to buffer entry. Will be 0 if no buffer entry "loaded" to output registers (from <a class="el" href="registers_8c.html" title="iSensor-SPI-Buffer register interfacing module. Called by user SPI and USB CLI">registers.c</a>)</p>
<p>Pointer to buffer entry. Will be 0 if no buffer entry "loaded" to output registers </p>

</div>
</div>
<a id="ad9abdec236745828926dbed3d25cfad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9abdec236745828926dbed3d25cfad5">&#9670;&nbsp;</a></span>g_regs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t g_regs[3 *REG_PER_PAGE]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global register array (from <a class="el" href="registers_8c.html" title="iSensor-SPI-Buffer register interfacing module. Called by user SPI and USB CLI">registers.c</a>) </p>

</div>
</div>
<a id="a35c3e3dee022adebf0fc138c81b515b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35c3e3dee022adebf0fc138c81b515b9">&#9670;&nbsp;</a></span>g_spi2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SPI_HandleTypeDef g_spi2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>User SPI handle (from <a class="el" href="main_8c.html" title="iSensor-SPI-Buffer main. Contains STM init functions and application cyclic executive.">main.c</a>)</p>
<p>SPI handle for slave port (from master controller). Global scope </p>

</div>
</div>
<a id="a090b8a30a19d0dbdd3dbcfed8dc2df69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a090b8a30a19d0dbdd3dbcfed8dc2df69">&#9670;&nbsp;</a></span>g_userburstRunning</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint32_t g_userburstRunning</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Track if a burst read is enabled. Global scope </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
